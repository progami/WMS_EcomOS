# Nginx configuration snippet for the main domain (www.targonglobal.com)
# This should be added to the main domain's nginx configuration

# Add this location block inside the server block for www.targonglobal.com

    # WMS Application
    location /WMS {
        # Proxy to WMS EC2 instance (use private IP in production)
        # Replace WMS_EC2_PRIVATE_IP with actual private IP
        proxy_pass http://WMS_EC2_PRIVATE_IP;
        
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_cache_bypass $http_upgrade;
        
        # Pass original host and protocol
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Forwarded-Host $host;
        
        # Don't strip the /WMS prefix - Next.js basePath handles it
        # The application expects requests at /WMS/*
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # Buffer settings
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;
        
        # File upload size (match WMS config)
        client_max_body_size 10M;
    }

    # Health check for WMS (optional)
    location = /WMS/health {
        access_log off;
        proxy_pass http://WMS_EC2_PRIVATE_IP/health;
        proxy_set_header Host $host;
    }

# Example of complete server block structure:
# server {
#     listen 443 ssl http2;
#     server_name www.targonglobal.com;
#     
#     ssl_certificate /path/to/cert;
#     ssl_certificate_key /path/to/key;
#     
#     # Root website configuration
#     location / {
#         # Main website configuration
#     }
#     
#     # WMS Application
#     location /WMS {
#         # Configuration above
#     }
#     
#     # Future applications
#     # location /CRM {
#     #     proxy_pass http://CRM_EC2_PRIVATE_IP;
#     #     # Similar configuration
#     # }
# }