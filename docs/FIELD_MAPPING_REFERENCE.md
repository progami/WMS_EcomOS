# Field Mapping Reference Guide

This document provides a comprehensive reference for field mappings between import/export configurations and the database schema in the Warehouse Management System.

## Overview

The field mapping system ensures consistency across:
- **Import**: Excel/CSV files → Database
- **Export**: Database → Excel/CSV files
- **UI Display**: Database → User Interface
- **API**: Database → JSON responses

## Inventory Transactions Field Mapping

### Complete Field Reference

| Database Field | Import Column Names | Export Column Name | Type | Required | Notes |
|----------------|---------------------|-------------------|------|----------|-------|
| **Date/Time Fields** |
| `transactionDate` | Transaction Date, transaction_date, Date, Timestamp | Transaction Date | DateTime | ✅ Yes | Primary timestamp for the transaction |
| `pickupDate` | Pickup Date, pickup_date | Pickup Date | DateTime | ❌ No | Optional pickup/collection date |
| **Type/Status Fields** |
| `transactionType` | Type, transaction_type, Transaction_Type, Transaction Type | Type | Enum | ✅ Yes | RECEIVE, SHIP, ADJUST_IN, ADJUST_OUT, TRANSFER |
| `isReconciled` | Is Reconciled, is_reconciled, Reconciled | Is Reconciled | Boolean | ❌ No | Default: false |
| **Location Fields** |
| `warehouse` | Warehouse, warehouse, Warehouse Name | Warehouse | String | ✅ Yes | Resolved to warehouseId during import |
| **Product Fields** |
| `sku` | SKU Code, sku, SKU, sku_code | SKU Code | String | ✅ Yes | Resolved to skuId during import |
| `batchLot` | Batch/Lot, batch_lot, Shipment, Batch | Batch/Lot | String | ✅ Yes | Default: 'DEFAULT' |
| `referenceId` | Reference, reference_id, Reference_ID, Reference ID | Reference | String | ❌ No | External reference (e.g., PO number) |
| **Quantity Fields** |
| `cartonsIn` | Cartons In, cartons_in, Cartons_In | Cartons In | Number | ✅ Yes | Default: 0 |
| `cartonsOut` | Cartons Out, cartons_out, Cartons_Out | Cartons Out | Number | ✅ Yes | Default: 0 |
| `storagePalletsIn` | Storage Pallets In, storage_pallets_in, Pallets_In | Storage Pallets In | Number | ✅ Yes | Default: 0 |
| `shippingPalletsOut` | Shipping Pallets Out, shipping_pallets_out, Pallets_Out | Shipping Pallets Out | Number | ✅ Yes | Default: 0 |
| `storageCartonsPerPallet` | Storage Cartons/Pallet, storage_cartons_per_pallet, Storage CPP | Storage Cartons/Pallet | Number | ❌ No | Configuration override |
| `shippingCartonsPerPallet` | Shipping Cartons/Pallet, shipping_cartons_per_pallet, Shipping CPP | Shipping Cartons/Pallet | Number | ❌ No | Configuration override |
| **Shipping/Transport Fields** |
| `trackingNumber` | Tracking Number, tracking_number, Tracking | Tracking Number | String | ❌ No | Shipment tracking reference |
| `shipName` | Ship Name, ship_name, Vessel | Ship Name | String | ❌ No | Vessel/container name |
| `modeOfTransportation` | Mode of Transportation, mode_of_transportation, Transport Mode | Mode of Transportation | String | ❌ No | Air, Sea, Ground, etc. |

### System-Generated Fields (Not Imported)

These fields are automatically generated by the system and should not be included in import files:

| Database Field | Purpose | How it's Generated |
|----------------|---------|-------------------|
| `id` | Unique record identifier | UUID auto-generated |
| `transactionId` | Unique transaction reference | Auto-generated sequence |
| `createdAt` | Record creation timestamp | Current timestamp |
| `createdById` | User who created the record | From user session |
| `warehouseId` | Foreign key to warehouse | Resolved from warehouse name |
| `skuId` | Foreign key to SKU | Resolved from SKU code |
| `attachments` | JSON field for file references | Added via separate API |

## Import/Export Column Name Conventions

### Import Flexibility
The import system supports multiple column name variations to accommodate different Excel formats:
- **Primary Name**: The preferred column name (matches export)
- **Snake_case**: Traditional database column names (e.g., `transaction_date`)
- **Variations**: Common alternatives (e.g., `Type` vs `Transaction Type`)

### Export Consistency
Exports always use the standardized column names defined in `column-ordering.ts`:
- Human-readable format (e.g., "Transaction Date" not "transaction_date")
- Consistent across all exports
- Matches UI display names

## Validation Rules

### Required Fields
1. **Transaction Type**: Must be one of: RECEIVE, SHIP, ADJUST_IN, ADJUST_OUT, TRANSFER
2. **Warehouse**: Must match an existing warehouse name
3. **SKU**: Must match an existing SKU code
4. **Batch/Lot**: Defaults to 'DEFAULT' if not provided
5. **Quantity Fields**: Default to 0 if not provided

### Business Rules
1. For RECEIVE transactions: `cartonsIn` and `storagePalletsIn` should be > 0
2. For SHIP transactions: `cartonsOut` and `shippingPalletsOut` should be > 0
3. Cartons per pallet configurations override warehouse defaults if provided

## Field Grouping

Fields are organized into logical groups for better organization:

1. **datetime**: Date and time fields
2. **type**: Transaction type and status fields
3. **location**: Warehouse and location fields
4. **product**: SKU, batch, and product-related fields
5. **quantity**: Carton and pallet quantities
6. **shipping**: Shipping and transportation fields
7. **metadata**: System fields and audit trail

## Best Practices

### For Imports
1. Always include the required fields
2. Use the primary column names when possible
3. Ensure date formats are consistent (ISO 8601 preferred)
4. Validate transaction types before import
5. Check that warehouse and SKU values exist

### For Exports
1. Exports include all fields marked as `showInExport`
2. Related data (warehouse name, SKU code) is included
3. Dates are formatted in locale-specific format
4. Boolean values are exported as "Yes"/"No"

### For Development
1. Update `import-config.ts` when adding new importable fields
2. Update `column-ordering.ts` to maintain UI/export consistency
3. Run field mapping validation tests after schema changes
4. Document any special handling or business rules

## Testing Field Mappings

Run the validation script to ensure consistency:

```bash
npx tsx src/scripts/test-field-mappings.ts
```

This will validate:
- Import/export column name consistency
- Database field coverage
- Type compatibility
- Required field presence