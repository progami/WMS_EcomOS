# Vulnerability Tests

This directory contains security vulnerability tests for the WMS application. These tests are designed to identify potential security issues by demonstrating the difference between vulnerable and secure implementations.

## Test Structure

Each test follows a pattern:
1. **Vulnerable Implementation**: Shows code with security issues
2. **Secure Implementation**: Shows the proper way to handle the same scenario
3. **Validation**: Confirms that the vulnerable code has issues and the secure code handles them properly

## Test Categories

### 1. Authentication & Authorization (`auth-security/`)
- Rate limiting on login attempts
- Session validation and role changes
- API route whitelisting
- CSRF token validation
- Privilege escalation prevention
- Insecure direct object references

### 2. Data Validation (`data-validation/`)
- XSS prevention in user inputs
- SQL injection protection
- Excel formula injection prevention
- Path traversal protection
- File type validation
- Integer overflow handling
- Unicode character handling
- Command injection prevention

### 3. File Upload Security (`data-validation/file-upload-security.test.ts`)
- File size restrictions
- Double extension bypass prevention
- MIME type validation
- Zip bomb detection
- Filename sanitization
- Macro detection in Excel files
- Polyglot file detection

### 4. Performance & Memory (`memory-performance/`)
- Large dataset pagination
- Query result limiting
- Memory leak prevention
- Infinite loop detection
- Connection pool management
- Regex performance (catastrophic backtracking)
- Array growth limits
- CPU-intensive operation handling

### 5. External API Integration (`api-integration/`)
- Rate limit handling with exponential backoff
- Network timeout configuration
- Circuit breaker pattern
- Invalid response handling
- API key rotation handling
- Webhook retry logic
- Partial response handling
- API versioning conflicts
- OAuth token refresh synchronization

## Running Tests

```bash
# Run all vulnerability tests
npm run test:vulnerabilities

# Run specific test file
npm test tests/vulnerability-tests/auth-security/auth-vulnerabilities.test.ts

# Run with coverage
npm run test:vulnerabilities -- --coverage
```

## Important Notes

1. These tests demonstrate vulnerabilities by showing both insecure and secure implementations
2. The tests pass when they successfully identify the security issues
3. They are educational and help ensure security best practices are followed
4. The vulnerable code shown in tests should NEVER be used in production

## Test Philosophy

These tests follow the principle of "Security by Design" by:
- Making security issues visible and testable
- Providing clear examples of secure alternatives
- Ensuring security considerations are part of the development process
- Helping developers understand common security pitfalls